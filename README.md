
    
     ┌────┐                     ┌───┐                     ┌──────────┐               ┌────────┐
     │User│                     │ATM│                     │IAMService│               │Database│
     └─┬──┘                     └─┬─┘                     └────┬─────┘               └───┬────┘
       │ POST /login (APIkey, PIN)│                            │                         │     
       │ ─────────────────────────>                            │                         │     
       │                          │                            │                         │     
       │                          │ authenticates (APIkey, PIN)│                         │     
       │                          │ ───────────────────────────>                         │     
       │                          │                            │                         │     
       │                          │                            │ query user's APIkey, PIN│     
       │                          │                            │ ────────────────────────>     
       │                          │                            │                         │     
       │                          │                            │         success         │     
       │                          │                            │ <─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─      
       │                          │                            │                         │     
       │                          │       generates token      │                         │     
       │                          │ <─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─                         │     
       │                          │                            │                         │     
       │      responds token      │                            │                         │     
       │ <─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─                            │                         │     
       │                          │                            │                         │     
       │ POST /withdrawal (token) │                            │                         │     
       │ ─────────────────────────>                            │                         │     
       │                          │                            │                         │     
       │                          │    authenticates (token)   │                         │     
       │                          │ ───────────────────────────>                         │     
       │                          │                            │                         │     
       │                          │           success          │                         │     
       │                          │ <─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─                         │     
       │                          │                            │                         │     
       │                          │    query user balance (userID decoded from token)    │     
       │                          │ ─────────────────────────────────────────────────────>     
       │                          │                            │                         │     
       │                          │                     user balance                     │     
       │                          │ <─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─     
       │                          │                            │                         │     
       │                          │────┐                       │                         │     
       │                          │    │ calculate withdrawal  │                         │     
       │                          │<───┘                       │                         │     
       │                          │                            │                         │     
       │                          │                    update balance                    │     
       │                          │ ─────────────────────────────────────────────────────>     
       │                          │                            │                         │     
       │                          │                        success                       │     
       │                          │ <─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─     
       │                          │                            │                         │     
       │   POST /deposit (token)  │                            │                         │     
       │ ─────────────────────────>                            │                         │     
       │                          │                            │                         │     
       │                          │    authenticates (token)   │                         │     
       │                          │ ───────────────────────────>                         │     
       │                          │                            │                         │     
       │                          │           success          │                         │     
       │                          │ <─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─                         │     
       │                          │                            │                         │     
       │                          │    query user balance (userID decoded from token)    │     
       │                          │ ─────────────────────────────────────────────────────>     
       │                          │                            │                         │     
       │                          │                     user balance                     │     
       │                          │ <─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─     
       │                          │                            │                         │     
       │                          │────┐                       │                         │     
       │                          │    │ calculate deposit     │                         │     
       │                          │<───┘                       │                         │     
       │                          │                            │                         │     
       │                          │                    update balance                    │     
       │                          │ ─────────────────────────────────────────────────────>     
       │                          │                            │                         │     
       │                          │                        success                       │     
       │                          │ <─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─     
       │                          │                            │                         │     
       │     responded balance    │                            │                         │     
       │ <─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─                            │                         │     
       │                          │                            │                         │     
       │   GET /balance (token)   │                            │                         │     
       │ ─────────────────────────>                            │                         │     
       │                          │                            │                         │     
       │                          │    authenticates (token)   │                         │     
       │                          │ ───────────────────────────>                         │     
       │                          │                            │                         │     
       │                          │           success          │                         │     
       │                          │ <─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─                         │     
       │                          │                            │                         │     
       │                          │    query user balance (userID decoded from token)    │     
       │                          │ ─────────────────────────────────────────────────────>     
       │                          │                            │                         │     
       │                          │                     user balance                     │     
       │                          │ <─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─     
       │                          │                            │                         │     
       │     responded balance    │                            │                         │     
       │ <─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─                            │                         │     
     ┌─┴──┐                     ┌─┴─┐                     ┌────┴─────┐               ┌───┴────┐
     │User│                     │ATM│                     │IAMService│               │Database│
     └────┘                     └───┘                     └──────────┘               └────────┘
